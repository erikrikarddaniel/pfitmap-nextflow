#!/usr/bin/env nextflow

params.input= "/home/ghada/dev/pfitmap-nextflow/testdata/genomes/*.faa.gz"

genomes = Channel.fromPath(params.input)
         .collect()
      
process singleFaa {

  input: 
  file (fastas) from genomes

  output:
  file 'all_genomes.faa' into hmmSearch_ch

  shell:
  """
  zcat ${fastas} > all_genomes.faa
  """
}

process hmmsearch {
  publishDir "/home/ghada/dev/pfitmap_nextflow/testdata", mode: 'copy'

  input:
  file "HMMER_DB_FAA" from hmmSearch_ch
  file "hmm_profiles" from Channel.fromPath("/home/ghada/dev/pfitmap-nextflow/testdata/profiles/*alnfaa")

  output:
  file "*.tblout" into tblout_ch
#  file "*.domtblout" into domtblout_ch

  shell:
  """
  make -f ../../biomakefiles/lib/make/makefile.hmmer all_hmmout
  """
}
